var toot = {
    //gravity: (300 * 0.27),
    gravity: 300,
    fartStrength: 250,
    currentDistance: 0,

    soundsEnabled: false,

    // namespacing
    character: {},
    environment: {},
    obstacle: {},
    ui: {}
};



var run = function() {

    var stats = new Stats();
    document.body.appendChild(stats.domElement);
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0px';

    var game = new Phaser.Game(
        1334, 750,
        Phaser.AUTO,
        '', {
            preload: preload,
            create: create,
            update: update
        });

    //var cursors;
    var player = new toot.character.Player(game);

    var ground = new toot.environment.Ground(game);
    var background = new toot.environment.Background(game);

    var uiDistance = new toot.ui.Distance(game);

    var vignette = new toot.environment.Vignette(game);

    var obstacles = new toot.obstacle.Generator(game);

    player.registerObserver('position', obstacles.updatePlayerPosition);

    function preload () {
        background.preload();
        ground.preload();
        player.preload();
        vignette.preload();

        obstacles.preload();

        uiDistance.preload();
    }

    function create () {

        game.physics.startSystem(Phaser.Physics.ARCADE);
        //game.physics.startSystem(Phaser.Physics.NINJA);
        //game.physics.startSystem(Phaser.Physics.P2JS);

        game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        game.scale.pageAlignHorizontally = true;
        game.scale.pageAlignVertically = true;
        game.scale.setScreenSize(true);
        game.scale.refresh();

        // Create game objects
        background.create();
        ground.create();
        player.create();


        obstacles.create();

        //uiDistance.create();

        vignette.create();
    }

    function collisionHandler(toot, obstacle) {
        console.log('collision detected!');
    }

    function update() {
        stats.begin();

        game.physics.arcade.collide(player.getColliders(), ground.getColliders());
        game.physics.arcade.collide(player.getColliders(), obstacles.getColliders(), collisionHandler, null, this);

        background.update();
        ground.update();
        player.update();

        obstacles.update();

        //uiDistance.update();

        toot.currentDistance++;

        stats.end();
    }

};


toot.character.Player = function(game) {
    this.game = game;
    this.spriteToot = null;
    this.spriteBlast = null;

    this.debug = false;

    this.observers = {};
};

toot.character.Player.prototype.preload = function() {
    this.game.load.spritesheet('toot', 'images/toot-spritesheet.png', 64, 96);
    this.game.load.spritesheet('blast', 'images/blast-spritesheet.png', 60, 63);

    this.game.load.audio('fart', 'sounds/fart-02.wav');
};

toot.character.Player.prototype.create = function() {
    // player
    var startX = this.game.world.width * 0.15;
    var startY = this.game.world.height - 256;

    this.spriteToot = this.game.add.sprite(startX, startY, 'toot');
    this.game.physics.arcade.enable(this.spriteToot);

    this.spriteToot.body.gravity.y = toot.gravity;
    this.spriteToot.body.collideWorldBounds = true;

    this.spriteToot.animations.add('run', [5, 6, 7, 8], 6, true);
    this.spriteToot.animations.add('land', [5, 6, 7, 8], 2, true);

    // blast
    this.spriteBlast = this.game.add.sprite(startX - 60, startY + 60, 'blast');
    this.spriteBlast.animations.add('fart', [1, 3, 4, 4, 0], 10, false);

    this.soundFart = this.game.add.audio('fart');
    this.soundFart.allowMultiple = false;
};

toot.character.Player.prototype.update = function(cursors) {
    //  Reset the players velocity (movement)
    this.spriteToot.body.velocity.x = 0;

    //console.log(this.sprite.body.velocity.y);

    if (this.game.input.activePointer.isDown) {
        this.spriteToot.body.velocity.y = toot.fartStrength * -1;
        this.spriteBlast.animations.play('fart');
        //this.soundFart.play('', 0.35, 1, false, false);
        this.soundFart.play('', 0, 1, false, false);
    }
    if (this.spriteToot.body.touching.down) {
        this.spriteToot.animations.play('run');
        this.spriteBlast.frame = 0;
    }
    else if (this.spriteToot.body.velocity.y > 0 &&
             this.spriteToot.body.velocity.y > (toot.fartStrength * 0.66)) {
        this.spriteToot.animations.play('land');
    }
    else {
        this.spriteToot.frame = 4;
    }

    this.spriteBlast.position.x = this.spriteToot.position.x - 38;
    this.spriteBlast.position.y = this.spriteToot.position.y + 80;

    // update toot.state variable
    this.notify('position', {
        x: this.spriteToot.position.x,
        y: this.spriteToot.position.y + 40
    });

    if (this.debug) {
        this.game.debug.body(this.spriteToot);
    }
};

toot.character.Player.prototype.getColliders = function() {
    return this.spriteToot;
};

toot.character.Player.prototype.notify = function(event, arg) {
    var callbacks = this.observers[event];
    if (typeof callbacks === 'undefined') {
        return;
    }
    callbacks.forEach(function(callback) {
        callback(arg);
    });
};

toot.character.Player.prototype.registerObserver = function(event, callback) {
    if (typeof this.observers[event] === 'undefined') {
        this.observers[event] = [];
    }
    this.observers[event].push(callback);
};


toot.environment.Background = function(game) {
    this.game = game;
};

toot.environment.Background.prototype.preload = function() {
    this.game.load.image('bg-space', 'images/bg-space.jpg');
    this.game.load.image('bg-stars-small', 'images/bg-stars-small.png');
    this.game.load.image('bg-stars-dense', 'images/bg-stars-small-dense.png');
    this.game.load.image('bg-stars-large', 'images/bg-stars-large.png');

    this.game.load.image('bg-horizon', 'images/bg-horizon-gradient.png');
    this.game.load.image('bg-mountains-01', 'images/bg-mountains-01.png');
    this.game.load.image('bg-mountains-02', 'images/bg-mountains-02.png');
};

toot.environment.Background.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.spaceBg = this.game.add.tileSprite(0, 0, w, h, 'bg-space');
    this.starsLg = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-large');
    this.spaceDs = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-dense');
    this.starsSm = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-small');

    this.horizon = this.game.add.tileSprite(0, 0, w, h, 'bg-horizon');

    this.mountains1 = this.game.add.tileSprite(0, 0, w, h, 'bg-mountains-01');
    this.mountains2 = this.game.add.tileSprite(0, 0, w, h, 'bg-mountains-02');
};

toot.environment.Background.prototype.update = function() {
    this.spaceBg.tilePosition.x -= 0.075;
    this.starsLg.tilePosition.x -= 0.100;
    this.spaceDs.tilePosition.x -= 0.125;
    this.starsSm.tilePosition.x -= 0.150;

    this.mountains1.tilePosition.x -= 0.20;
    this.mountains2.tilePosition.x -= 0.25;
};


toot.environment.Ground = function(game) {
    this.game = game;
};

toot.environment.Ground.prototype.preload = function() {
    this.game.load.image('ground', 'images/ground.jpg');
};

toot.environment.Ground.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    var yPos = h - 97;
    this.ground = this.game.add.tileSprite(0, yPos, w, h, 'ground');

    this.game.physics.arcade.enable(this.ground);
    this.ground.body.immovable = true;

    // bug in phaser 2.3.0
    // see: http://www.html5gamedevs.com/topic/13856-problem-with-collide-method-from-physics-arcade-in-different-versions-of-phaser/?p=79032
    this.ground.physicsType = Phaser.SPRITE;
};

toot.environment.Ground.prototype.update = function() {
    this.ground.tilePosition.x -= 0.85;
};

toot.environment.Ground.prototype.getColliders = function() {
    return this.ground;
};

toot.environment.Vignette = function(game) {
    this.game = game;
};

toot.environment.Vignette.prototype.preload = function() {
    this.game.load.image('vignette', 'images/vignette.png');
};

toot.environment.Vignette.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.v = this.game.add.sprite(0, 0, 'vignette');
};

toot.obstacle.Generator = function(game) {
    this.game = game;
    //this.saucer = new toot.obstacle.Saucer(this.game);
    this.probe = new toot.obstacle.Probe(this.game);

    this.playerPositionY = -1;
    var generator = this;
    this.updatePlayerPosition = function(pos) {
        generator.playerPositionY = pos.y;
    };
};

toot.obstacle.Generator.prototype.preload = function() {
    //this.saucer.preload();
    this.probe.preload();
};

toot.obstacle.Generator.prototype.create = function() {
    //this.saucer.create();
    this.probe.create();
    this.reset();
};

toot.obstacle.Generator.prototype.update = function() {
    //if (!this.saucer.inWorld()) {
    //    console.log('saucer is off world!');
    //    this.saucer.stop();
    //    this.reset();
    //}

    //this.saucer.update();
    if (!this.probe.inWorld()) {
        console.log('probe is off world!');
        this.probe.stop();
        this.reset();
    }
    this.probe.update();
};

toot.obstacle.Generator.prototype.getColliders = function() {
    return this.probe.getColliders();
};

toot.obstacle.Generator.prototype.reset = function() {

    var x = this.game.world.width - 100;
    var miny = 65;
    var maxy = this.game.world.height - 165;

    var y = this.playerPositionY;
    console.log('playerPositionY: ' + this.playerPositionY);
    if (y < miny) {
        y = miny;
    }
    else if (y > maxy) {
        y = maxy;
    }

    this.probe.reset(x, y);
};


toot.obstacle.Probe = function(game) {
    this.game = game;

    this.spriteProbe = null;
    this.collisionGroup = null;

    this.velocity = 200;
    this.rotMax = 0.05;
    this.rotInc = 0.005;

    this.debug = false;
};

toot.obstacle.Probe.prototype.preload = function() {
    this.game.load.spritesheet('probe', 'images/probe-spritesheet.png', 276, 100);

    //this.game.load.audio('ufo', 'sounds/ufo-01.wav');
};

toot.obstacle.Probe.prototype.reset = function(x, y) {
    console.log('resetting Probe to ' + x + ', ' + y);
    this.collisionGroup.forEach(function(item) {
        item.reset(x, y);
    });
    this.collisionGroup.setAll('body.velocity.x', this.velocity * -1);

    //this.soundUfo.play('', 0, 1, true, false);
};

toot.obstacle.Probe.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    //this.soundUfo = this.game.add.audio('ufo');
    //this.soundUfo.allowMultiple = false;

    this.collisionGroup = this.game.add.group();
    this.game.physics.arcade.enable(this.collisionGroup);
    this.collisionGroup.checkWorldBounds = true;

    this.spriteProbe = this.collisionGroup.create(w, 128, 'probe');
    this.spriteProbe.scale.set(0.5, 0.5);
    this.spriteProbe.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(this.spriteProbe);
    this.spriteProbe.body.allowGravity = false;
    this.spriteProbe.body.immovable = true;
    //this.spriteProbe.body.setSize(64, 20, -10, -37);

};

toot.obstacle.Probe.prototype.inWorld = function() {
    return this.spriteProbe.inWorld;
};

toot.obstacle.Probe.prototype.stop = function() {
    //this.soundUfo.stop();
};

toot.obstacle.Probe.prototype.update = function() {

    if (this.spriteProbe.rotation >= this.rotMax ||
        this.spriteProbe.rotation <= (this.rotMax * -1)) {
        this.rotInc = this.rotInc * -1;
    }
    this.spriteProbe.rotation += this.rotInc;

    if (this.debug) {
        var probe = this;
        this.collisionGroup.forEach(function(child) {
            probe.game.debug.body(child);
        });
    }
};

toot.obstacle.Probe.prototype.getColliders = function() {
    return this.collisionGroup;
};


toot.obstacle.Saucer = function(game) {
    this.game = game;

    this.spriteSaucer = null;
    this.collisionGroup = null;

    this.velocity = 300;
    this.rotMax = 0.025;
    this.rotInc = 0.0025;

    this.debug = false;
};

toot.obstacle.Saucer.prototype.preload = function() {
    this.game.load.spritesheet('saucer', 'images/saucer-spritesheet.png', 276, 100);

    this.game.load.audio('ufo', 'sounds/ufo-01.wav');
};

toot.obstacle.Saucer.prototype.reset = function(x, y) {
    console.log('resetting saucer to ' + x + ', ' + y);
    this.collisionGroup.forEach(function(item) {
        item.reset(x, y);
    });
    this.collisionGroup.setAll('body.velocity.x', this.velocity * -1);

    this.soundUfo.play('', 0, 1, true, false);
};

toot.obstacle.Saucer.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    this.soundUfo = this.game.add.audio('ufo');
    this.soundUfo.allowMultiple = false;

    this.collisionGroup = this.game.add.group();
    this.game.physics.arcade.enable(this.collisionGroup);
    //this.collisionGroup.body.allowGravity = false;
    //this.collisionGroup.body.immovable = true;
    this.collisionGroup.checkWorldBounds = true;

    //this.spriteSaucer = this.game.add.sprite(w, 128, 'saucer');
    this.spriteSaucer = this.collisionGroup.create(w, 128, 'saucer');
    this.spriteSaucer.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(this.spriteSaucer);
    this.spriteSaucer.body.allowGravity = false;
    this.spriteSaucer.body.immovable = true;
    this.spriteSaucer.body.setSize(64, 20, -10, -37);

    // Additional collider boxes to match the shape of the saucer more closely
    var c1 = this.collisionGroup.create(w, 128, '');
    c1.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(c1);
    c1.body.allowGravity = false;
    c1.body.immovable = true;
    c1.body.setSize(200, 22, -4, -16);

    var c2 = this.collisionGroup.create(w, 128, '');
    c2.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(c2);
    c2.body.allowGravity = false;
    c2.body.immovable = true;
    c2.body.setSize(270, 32, -4, 11);

    var c3 = this.collisionGroup.create(w, 128, '');
    c3.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(c3);
    c3.allowGravity = false;
    c3.body.immovable = true;
    c3.body.setSize(200, 16, -4, 35);
};

toot.obstacle.Saucer.prototype.inWorld = function() {
    return this.spriteSaucer.inWorld;
};

toot.obstacle.Saucer.prototype.stop = function() {
    this.soundUfo.stop();
};

toot.obstacle.Saucer.prototype.update = function() {

    if (this.spriteSaucer.rotation >= this.rotMax ||
        this.spriteSaucer.rotation <= (this.rotMax * -1)) {
        this.rotInc = this.rotInc * -1;
    }
    this.spriteSaucer.rotation += this.rotInc;

    if (this.debug) {
        var saucer = this;
        this.collisionGroup.forEach(function(child) {
            saucer.game.debug.body(child);
        });
    }
};

toot.obstacle.Saucer.prototype.getColliders = function() {
    return this.collisionGroup;
};

toot.ui.Distance = function(game) {
    this.game = game;
};

toot.ui.Distance.prototype.preload = function() {
};

toot.ui.Distance.prototype.create = function() {
    var w = this.game.world.width;
    this.display = this.game.add.text(16, 16, 'distance: 0', {
        fontSize: '32px', fill: '#fff'
    });
};

toot.ui.Distance.prototype.update = function() {
    this.display.text = 'distance: ' + Math.round(toot.currentDistance / 10);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJjaGFyYWN0ZXIvcGxheWVyLmpzIiwiZW52aXJvbm1lbnQvYmFja2dyb3VuZC5qcyIsImVudmlyb25tZW50L2dyb3VuZC5qcyIsImVudmlyb25tZW50L3ZpZ25ldHRlLmpzIiwib2JzdGFjbGUvZ2VuZXJhdG9yLmpzIiwib2JzdGFjbGUvcHJvYmUuanMiLCJvYnN0YWNsZS9zYXVjZXIuanMiLCJ1aS9kaXN0YW5jZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2FtZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdG9vdCA9IHtcbiAgICAvL2dyYXZpdHk6ICgzMDAgKiAwLjI3KSxcbiAgICBncmF2aXR5OiAzMDAsXG4gICAgZmFydFN0cmVuZ3RoOiAyNTAsXG4gICAgY3VycmVudERpc3RhbmNlOiAwLFxuXG4gICAgc291bmRzRW5hYmxlZDogZmFsc2UsXG5cbiAgICAvLyBuYW1lc3BhY2luZ1xuICAgIGNoYXJhY3Rlcjoge30sXG4gICAgZW52aXJvbm1lbnQ6IHt9LFxuICAgIG9ic3RhY2xlOiB7fSxcbiAgICB1aToge31cbn07XG5cblxuXG52YXIgcnVuID0gZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN0YXRzLmRvbUVsZW1lbnQpO1xuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzBweCc7XG5cbiAgICB2YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZShcbiAgICAgICAgMTMzNCwgNzUwLFxuICAgICAgICBQaGFzZXIuQVVUTyxcbiAgICAgICAgJycsIHtcbiAgICAgICAgICAgIHByZWxvYWQ6IHByZWxvYWQsXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXG4gICAgICAgIH0pO1xuXG4gICAgLy92YXIgY3Vyc29ycztcbiAgICB2YXIgcGxheWVyID0gbmV3IHRvb3QuY2hhcmFjdGVyLlBsYXllcihnYW1lKTtcblxuICAgIHZhciBncm91bmQgPSBuZXcgdG9vdC5lbnZpcm9ubWVudC5Hcm91bmQoZ2FtZSk7XG4gICAgdmFyIGJhY2tncm91bmQgPSBuZXcgdG9vdC5lbnZpcm9ubWVudC5CYWNrZ3JvdW5kKGdhbWUpO1xuXG4gICAgdmFyIHVpRGlzdGFuY2UgPSBuZXcgdG9vdC51aS5EaXN0YW5jZShnYW1lKTtcblxuICAgIHZhciB2aWduZXR0ZSA9IG5ldyB0b290LmVudmlyb25tZW50LlZpZ25ldHRlKGdhbWUpO1xuXG4gICAgdmFyIG9ic3RhY2xlcyA9IG5ldyB0b290Lm9ic3RhY2xlLkdlbmVyYXRvcihnYW1lKTtcblxuICAgIHBsYXllci5yZWdpc3Rlck9ic2VydmVyKCdwb3NpdGlvbicsIG9ic3RhY2xlcy51cGRhdGVQbGF5ZXJQb3NpdGlvbik7XG5cbiAgICBmdW5jdGlvbiBwcmVsb2FkICgpIHtcbiAgICAgICAgYmFja2dyb3VuZC5wcmVsb2FkKCk7XG4gICAgICAgIGdyb3VuZC5wcmVsb2FkKCk7XG4gICAgICAgIHBsYXllci5wcmVsb2FkKCk7XG4gICAgICAgIHZpZ25ldHRlLnByZWxvYWQoKTtcblxuICAgICAgICBvYnN0YWNsZXMucHJlbG9hZCgpO1xuXG4gICAgICAgIHVpRGlzdGFuY2UucHJlbG9hZCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZSAoKSB7XG5cbiAgICAgICAgZ2FtZS5waHlzaWNzLnN0YXJ0U3lzdGVtKFBoYXNlci5QaHlzaWNzLkFSQ0FERSk7XG4gICAgICAgIC8vZ2FtZS5waHlzaWNzLnN0YXJ0U3lzdGVtKFBoYXNlci5QaHlzaWNzLk5JTkpBKTtcbiAgICAgICAgLy9nYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuUDJKUyk7XG5cbiAgICAgICAgZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgICBnYW1lLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICAgIGdhbWUuc2NhbGUucGFnZUFsaWduVmVydGljYWxseSA9IHRydWU7XG4gICAgICAgIGdhbWUuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcbiAgICAgICAgZ2FtZS5zY2FsZS5yZWZyZXNoKCk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGdhbWUgb2JqZWN0c1xuICAgICAgICBiYWNrZ3JvdW5kLmNyZWF0ZSgpO1xuICAgICAgICBncm91bmQuY3JlYXRlKCk7XG4gICAgICAgIHBsYXllci5jcmVhdGUoKTtcblxuXG4gICAgICAgIG9ic3RhY2xlcy5jcmVhdGUoKTtcblxuICAgICAgICAvL3VpRGlzdGFuY2UuY3JlYXRlKCk7XG5cbiAgICAgICAgdmlnbmV0dGUuY3JlYXRlKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29sbGlzaW9uSGFuZGxlcih0b290LCBvYnN0YWNsZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnY29sbGlzaW9uIGRldGVjdGVkIScpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICAgICAgc3RhdHMuYmVnaW4oKTtcblxuICAgICAgICBnYW1lLnBoeXNpY3MuYXJjYWRlLmNvbGxpZGUocGxheWVyLmdldENvbGxpZGVycygpLCBncm91bmQuZ2V0Q29sbGlkZXJzKCkpO1xuICAgICAgICBnYW1lLnBoeXNpY3MuYXJjYWRlLmNvbGxpZGUocGxheWVyLmdldENvbGxpZGVycygpLCBvYnN0YWNsZXMuZ2V0Q29sbGlkZXJzKCksIGNvbGxpc2lvbkhhbmRsZXIsIG51bGwsIHRoaXMpO1xuXG4gICAgICAgIGJhY2tncm91bmQudXBkYXRlKCk7XG4gICAgICAgIGdyb3VuZC51cGRhdGUoKTtcbiAgICAgICAgcGxheWVyLnVwZGF0ZSgpO1xuXG4gICAgICAgIG9ic3RhY2xlcy51cGRhdGUoKTtcblxuICAgICAgICAvL3VpRGlzdGFuY2UudXBkYXRlKCk7XG5cbiAgICAgICAgdG9vdC5jdXJyZW50RGlzdGFuY2UrKztcblxuICAgICAgICBzdGF0cy5lbmQoKTtcbiAgICB9XG5cbn07XG4iLCJcbnRvb3QuY2hhcmFjdGVyLlBsYXllciA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgIHRoaXMuc3ByaXRlVG9vdCA9IG51bGw7XG4gICAgdGhpcy5zcHJpdGVCbGFzdCA9IG51bGw7XG5cbiAgICB0aGlzLmRlYnVnID0gZmFsc2U7XG5cbiAgICB0aGlzLm9ic2VydmVycyA9IHt9O1xufTtcblxudG9vdC5jaGFyYWN0ZXIuUGxheWVyLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLmxvYWQuc3ByaXRlc2hlZXQoJ3Rvb3QnLCAnaW1hZ2VzL3Rvb3Qtc3ByaXRlc2hlZXQucG5nJywgNjQsIDk2KTtcbiAgICB0aGlzLmdhbWUubG9hZC5zcHJpdGVzaGVldCgnYmxhc3QnLCAnaW1hZ2VzL2JsYXN0LXNwcml0ZXNoZWV0LnBuZycsIDYwLCA2Myk7XG5cbiAgICB0aGlzLmdhbWUubG9hZC5hdWRpbygnZmFydCcsICdzb3VuZHMvZmFydC0wMi53YXYnKTtcbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gcGxheWVyXG4gICAgdmFyIHN0YXJ0WCA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aCAqIDAuMTU7XG4gICAgdmFyIHN0YXJ0WSA9IHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQgLSAyNTY7XG5cbiAgICB0aGlzLnNwcml0ZVRvb3QgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZShzdGFydFgsIHN0YXJ0WSwgJ3Rvb3QnKTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKHRoaXMuc3ByaXRlVG9vdCk7XG5cbiAgICB0aGlzLnNwcml0ZVRvb3QuYm9keS5ncmF2aXR5LnkgPSB0b290LmdyYXZpdHk7XG4gICAgdGhpcy5zcHJpdGVUb290LmJvZHkuY29sbGlkZVdvcmxkQm91bmRzID0gdHJ1ZTtcblxuICAgIHRoaXMuc3ByaXRlVG9vdC5hbmltYXRpb25zLmFkZCgncnVuJywgWzUsIDYsIDcsIDhdLCA2LCB0cnVlKTtcbiAgICB0aGlzLnNwcml0ZVRvb3QuYW5pbWF0aW9ucy5hZGQoJ2xhbmQnLCBbNSwgNiwgNywgOF0sIDIsIHRydWUpO1xuXG4gICAgLy8gYmxhc3RcbiAgICB0aGlzLnNwcml0ZUJsYXN0ID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoc3RhcnRYIC0gNjAsIHN0YXJ0WSArIDYwLCAnYmxhc3QnKTtcbiAgICB0aGlzLnNwcml0ZUJsYXN0LmFuaW1hdGlvbnMuYWRkKCdmYXJ0JywgWzEsIDMsIDQsIDQsIDBdLCAxMCwgZmFsc2UpO1xuXG4gICAgdGhpcy5zb3VuZEZhcnQgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdmYXJ0Jyk7XG4gICAgdGhpcy5zb3VuZEZhcnQuYWxsb3dNdWx0aXBsZSA9IGZhbHNlO1xufTtcblxudG9vdC5jaGFyYWN0ZXIuUGxheWVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihjdXJzb3JzKSB7XG4gICAgLy8gIFJlc2V0IHRoZSBwbGF5ZXJzIHZlbG9jaXR5IChtb3ZlbWVudClcbiAgICB0aGlzLnNwcml0ZVRvb3QuYm9keS52ZWxvY2l0eS54ID0gMDtcblxuICAgIC8vY29uc29sZS5sb2codGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS55KTtcblxuICAgIGlmICh0aGlzLmdhbWUuaW5wdXQuYWN0aXZlUG9pbnRlci5pc0Rvd24pIHtcbiAgICAgICAgdGhpcy5zcHJpdGVUb290LmJvZHkudmVsb2NpdHkueSA9IHRvb3QuZmFydFN0cmVuZ3RoICogLTE7XG4gICAgICAgIHRoaXMuc3ByaXRlQmxhc3QuYW5pbWF0aW9ucy5wbGF5KCdmYXJ0Jyk7XG4gICAgICAgIC8vdGhpcy5zb3VuZEZhcnQucGxheSgnJywgMC4zNSwgMSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5zb3VuZEZhcnQucGxheSgnJywgMCwgMSwgZmFsc2UsIGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc3ByaXRlVG9vdC5ib2R5LnRvdWNoaW5nLmRvd24pIHtcbiAgICAgICAgdGhpcy5zcHJpdGVUb290LmFuaW1hdGlvbnMucGxheSgncnVuJyk7XG4gICAgICAgIHRoaXMuc3ByaXRlQmxhc3QuZnJhbWUgPSAwO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLnNwcml0ZVRvb3QuYm9keS52ZWxvY2l0eS55ID4gMCAmJlxuICAgICAgICAgICAgIHRoaXMuc3ByaXRlVG9vdC5ib2R5LnZlbG9jaXR5LnkgPiAodG9vdC5mYXJ0U3RyZW5ndGggKiAwLjY2KSkge1xuICAgICAgICB0aGlzLnNwcml0ZVRvb3QuYW5pbWF0aW9ucy5wbGF5KCdsYW5kJyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnNwcml0ZVRvb3QuZnJhbWUgPSA0O1xuICAgIH1cblxuICAgIHRoaXMuc3ByaXRlQmxhc3QucG9zaXRpb24ueCA9IHRoaXMuc3ByaXRlVG9vdC5wb3NpdGlvbi54IC0gMzg7XG4gICAgdGhpcy5zcHJpdGVCbGFzdC5wb3NpdGlvbi55ID0gdGhpcy5zcHJpdGVUb290LnBvc2l0aW9uLnkgKyA4MDtcblxuICAgIC8vIHVwZGF0ZSB0b290LnN0YXRlIHZhcmlhYmxlXG4gICAgdGhpcy5ub3RpZnkoJ3Bvc2l0aW9uJywge1xuICAgICAgICB4OiB0aGlzLnNwcml0ZVRvb3QucG9zaXRpb24ueCxcbiAgICAgICAgeTogdGhpcy5zcHJpdGVUb290LnBvc2l0aW9uLnkgKyA0MFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuZGVidWcpIHtcbiAgICAgICAgdGhpcy5nYW1lLmRlYnVnLmJvZHkodGhpcy5zcHJpdGVUb290KTtcbiAgICB9XG59O1xuXG50b290LmNoYXJhY3Rlci5QbGF5ZXIucHJvdG90eXBlLmdldENvbGxpZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNwcml0ZVRvb3Q7XG59O1xuXG50b290LmNoYXJhY3Rlci5QbGF5ZXIucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uKGV2ZW50LCBhcmcpIHtcbiAgICB2YXIgY2FsbGJhY2tzID0gdGhpcy5vYnNlcnZlcnNbZXZlbnRdO1xuICAgIGlmICh0eXBlb2YgY2FsbGJhY2tzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrKGFyZyk7XG4gICAgfSk7XG59O1xuXG50b290LmNoYXJhY3Rlci5QbGF5ZXIucHJvdG90eXBlLnJlZ2lzdGVyT2JzZXJ2ZXIgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHtcbiAgICBpZiAodHlwZW9mIHRoaXMub2JzZXJ2ZXJzW2V2ZW50XSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlcnNbZXZlbnRdID0gW107XG4gICAgfVxuICAgIHRoaXMub2JzZXJ2ZXJzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTtcbn07XG4iLCJcbnRvb3QuZW52aXJvbm1lbnQuQmFja2dyb3VuZCA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5CYWNrZ3JvdW5kLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2JnLXNwYWNlJywgJ2ltYWdlcy9iZy1zcGFjZS5qcGcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctc3RhcnMtc21hbGwnLCAnaW1hZ2VzL2JnLXN0YXJzLXNtYWxsLnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1zdGFycy1kZW5zZScsICdpbWFnZXMvYmctc3RhcnMtc21hbGwtZGVuc2UucG5nJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2JnLXN0YXJzLWxhcmdlJywgJ2ltYWdlcy9iZy1zdGFycy1sYXJnZS5wbmcnKTtcblxuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1ob3Jpem9uJywgJ2ltYWdlcy9iZy1ob3Jpem9uLWdyYWRpZW50LnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1tb3VudGFpbnMtMDEnLCAnaW1hZ2VzL2JnLW1vdW50YWlucy0wMS5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctbW91bnRhaW5zLTAyJywgJ2ltYWdlcy9iZy1tb3VudGFpbnMtMDIucG5nJyk7XG59O1xuXG50b290LmVudmlyb25tZW50LkJhY2tncm91bmQucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcbiAgICB0aGlzLnNwYWNlQmcgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLXNwYWNlJyk7XG4gICAgdGhpcy5zdGFyc0xnID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1zdGFycy1sYXJnZScpO1xuICAgIHRoaXMuc3BhY2VEcyA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB3LCBoLCAnYmctc3RhcnMtZGVuc2UnKTtcbiAgICB0aGlzLnN0YXJzU20gPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLXN0YXJzLXNtYWxsJyk7XG5cbiAgICB0aGlzLmhvcml6b24gPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLWhvcml6b24nKTtcblxuICAgIHRoaXMubW91bnRhaW5zMSA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB3LCBoLCAnYmctbW91bnRhaW5zLTAxJyk7XG4gICAgdGhpcy5tb3VudGFpbnMyID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1tb3VudGFpbnMtMDInKTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuQmFja2dyb3VuZC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zcGFjZUJnLnRpbGVQb3NpdGlvbi54IC09IDAuMDc1O1xuICAgIHRoaXMuc3RhcnNMZy50aWxlUG9zaXRpb24ueCAtPSAwLjEwMDtcbiAgICB0aGlzLnNwYWNlRHMudGlsZVBvc2l0aW9uLnggLT0gMC4xMjU7XG4gICAgdGhpcy5zdGFyc1NtLnRpbGVQb3NpdGlvbi54IC09IDAuMTUwO1xuXG4gICAgdGhpcy5tb3VudGFpbnMxLnRpbGVQb3NpdGlvbi54IC09IDAuMjA7XG4gICAgdGhpcy5tb3VudGFpbnMyLnRpbGVQb3NpdGlvbi54IC09IDAuMjU7XG59O1xuIiwiXG50b290LmVudmlyb25tZW50Lkdyb3VuZCA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnZ3JvdW5kJywgJ2ltYWdlcy9ncm91bmQuanBnJyk7XG59O1xuXG50b290LmVudmlyb25tZW50Lkdyb3VuZC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdmFyIGggPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0O1xuXG4gICAgdmFyIHlQb3MgPSBoIC0gOTc7XG4gICAgdGhpcy5ncm91bmQgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgeVBvcywgdywgaCwgJ2dyb3VuZCcpO1xuXG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZSh0aGlzLmdyb3VuZCk7XG4gICAgdGhpcy5ncm91bmQuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuXG4gICAgLy8gYnVnIGluIHBoYXNlciAyLjMuMFxuICAgIC8vIHNlZTogaHR0cDovL3d3dy5odG1sNWdhbWVkZXZzLmNvbS90b3BpYy8xMzg1Ni1wcm9ibGVtLXdpdGgtY29sbGlkZS1tZXRob2QtZnJvbS1waHlzaWNzLWFyY2FkZS1pbi1kaWZmZXJlbnQtdmVyc2lvbnMtb2YtcGhhc2VyLz9wPTc5MDMyXG4gICAgdGhpcy5ncm91bmQucGh5c2ljc1R5cGUgPSBQaGFzZXIuU1BSSVRFO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ3JvdW5kLnRpbGVQb3NpdGlvbi54IC09IDAuODU7XG59O1xuXG50b290LmVudmlyb25tZW50Lkdyb3VuZC5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ3JvdW5kO1xufTtcbiIsInRvb3QuZW52aXJvbm1lbnQuVmlnbmV0dGUgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuVmlnbmV0dGUucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgndmlnbmV0dGUnLCAnaW1hZ2VzL3ZpZ25ldHRlLnBuZycpO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5WaWduZXR0ZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdmFyIGggPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0O1xuICAgIHRoaXMudiA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDAsIDAsICd2aWduZXR0ZScpO1xufTtcbiIsInRvb3Qub2JzdGFjbGUuR2VuZXJhdG9yID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgLy90aGlzLnNhdWNlciA9IG5ldyB0b290Lm9ic3RhY2xlLlNhdWNlcih0aGlzLmdhbWUpO1xuICAgIHRoaXMucHJvYmUgPSBuZXcgdG9vdC5vYnN0YWNsZS5Qcm9iZSh0aGlzLmdhbWUpO1xuXG4gICAgdGhpcy5wbGF5ZXJQb3NpdGlvblkgPSAtMTtcbiAgICB2YXIgZ2VuZXJhdG9yID0gdGhpcztcbiAgICB0aGlzLnVwZGF0ZVBsYXllclBvc2l0aW9uID0gZnVuY3Rpb24ocG9zKSB7XG4gICAgICAgIGdlbmVyYXRvci5wbGF5ZXJQb3NpdGlvblkgPSBwb3MueTtcbiAgICB9O1xufTtcblxudG9vdC5vYnN0YWNsZS5HZW5lcmF0b3IucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAvL3RoaXMuc2F1Y2VyLnByZWxvYWQoKTtcbiAgICB0aGlzLnByb2JlLnByZWxvYWQoKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuR2VuZXJhdG9yLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAvL3RoaXMuc2F1Y2VyLmNyZWF0ZSgpO1xuICAgIHRoaXMucHJvYmUuY3JlYXRlKCk7XG4gICAgdGhpcy5yZXNldCgpO1xufTtcblxudG9vdC5vYnN0YWNsZS5HZW5lcmF0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8vaWYgKCF0aGlzLnNhdWNlci5pbldvcmxkKCkpIHtcbiAgICAvLyAgICBjb25zb2xlLmxvZygnc2F1Y2VyIGlzIG9mZiB3b3JsZCEnKTtcbiAgICAvLyAgICB0aGlzLnNhdWNlci5zdG9wKCk7XG4gICAgLy8gICAgdGhpcy5yZXNldCgpO1xuICAgIC8vfVxuXG4gICAgLy90aGlzLnNhdWNlci51cGRhdGUoKTtcbiAgICBpZiAoIXRoaXMucHJvYmUuaW5Xb3JsZCgpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdwcm9iZSBpcyBvZmYgd29ybGQhJyk7XG4gICAgICAgIHRoaXMucHJvYmUuc3RvcCgpO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICAgIHRoaXMucHJvYmUudXBkYXRlKCk7XG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvYmUuZ2V0Q29sbGlkZXJzKCk7XG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHtcblxuICAgIHZhciB4ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoIC0gMTAwO1xuICAgIHZhciBtaW55ID0gNjU7XG4gICAgdmFyIG1heHkgPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0IC0gMTY1O1xuXG4gICAgdmFyIHkgPSB0aGlzLnBsYXllclBvc2l0aW9uWTtcbiAgICBjb25zb2xlLmxvZygncGxheWVyUG9zaXRpb25ZOiAnICsgdGhpcy5wbGF5ZXJQb3NpdGlvblkpO1xuICAgIGlmICh5IDwgbWlueSkge1xuICAgICAgICB5ID0gbWlueTtcbiAgICB9XG4gICAgZWxzZSBpZiAoeSA+IG1heHkpIHtcbiAgICAgICAgeSA9IG1heHk7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9iZS5yZXNldCh4LCB5KTtcbn07XG4iLCJcbnRvb3Qub2JzdGFjbGUuUHJvYmUgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcblxuICAgIHRoaXMuc3ByaXRlUHJvYmUgPSBudWxsO1xuICAgIHRoaXMuY29sbGlzaW9uR3JvdXAgPSBudWxsO1xuXG4gICAgdGhpcy52ZWxvY2l0eSA9IDIwMDtcbiAgICB0aGlzLnJvdE1heCA9IDAuMDU7XG4gICAgdGhpcy5yb3RJbmMgPSAwLjAwNTtcblxuICAgIHRoaXMuZGVidWcgPSBmYWxzZTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuUHJvYmUucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5zcHJpdGVzaGVldCgncHJvYmUnLCAnaW1hZ2VzL3Byb2JlLXNwcml0ZXNoZWV0LnBuZycsIDI3NiwgMTAwKTtcblxuICAgIC8vdGhpcy5nYW1lLmxvYWQuYXVkaW8oJ3VmbycsICdzb3VuZHMvdWZvLTAxLndhdicpO1xufTtcblxudG9vdC5vYnN0YWNsZS5Qcm9iZS5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgY29uc29sZS5sb2coJ3Jlc2V0dGluZyBQcm9iZSB0byAnICsgeCArICcsICcgKyB5KTtcbiAgICB0aGlzLmNvbGxpc2lvbkdyb3VwLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBpdGVtLnJlc2V0KHgsIHkpO1xuICAgIH0pO1xuICAgIHRoaXMuY29sbGlzaW9uR3JvdXAuc2V0QWxsKCdib2R5LnZlbG9jaXR5LngnLCB0aGlzLnZlbG9jaXR5ICogLTEpO1xuXG4gICAgLy90aGlzLnNvdW5kVWZvLnBsYXkoJycsIDAsIDEsIHRydWUsIGZhbHNlKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuUHJvYmUucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcblxuICAgIC8vdGhpcy5zb3VuZFVmbyA9IHRoaXMuZ2FtZS5hZGQuYXVkaW8oJ3VmbycpO1xuICAgIC8vdGhpcy5zb3VuZFVmby5hbGxvd011bHRpcGxlID0gZmFsc2U7XG5cbiAgICB0aGlzLmNvbGxpc2lvbkdyb3VwID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5jb2xsaXNpb25Hcm91cCk7XG4gICAgdGhpcy5jb2xsaXNpb25Hcm91cC5jaGVja1dvcmxkQm91bmRzID0gdHJ1ZTtcblxuICAgIHRoaXMuc3ByaXRlUHJvYmUgPSB0aGlzLmNvbGxpc2lvbkdyb3VwLmNyZWF0ZSh3LCAxMjgsICdwcm9iZScpO1xuICAgIHRoaXMuc3ByaXRlUHJvYmUuc2NhbGUuc2V0KDAuNSwgMC41KTtcbiAgICB0aGlzLnNwcml0ZVByb2JlLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZSh0aGlzLnNwcml0ZVByb2JlKTtcbiAgICB0aGlzLnNwcml0ZVByb2JlLmJvZHkuYWxsb3dHcmF2aXR5ID0gZmFsc2U7XG4gICAgdGhpcy5zcHJpdGVQcm9iZS5ib2R5LmltbW92YWJsZSA9IHRydWU7XG4gICAgLy90aGlzLnNwcml0ZVByb2JlLmJvZHkuc2V0U2l6ZSg2NCwgMjAsIC0xMCwgLTM3KTtcblxufTtcblxudG9vdC5vYnN0YWNsZS5Qcm9iZS5wcm90b3R5cGUuaW5Xb3JsZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNwcml0ZVByb2JlLmluV29ybGQ7XG59O1xuXG50b290Lm9ic3RhY2xlLlByb2JlLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7XG4gICAgLy90aGlzLnNvdW5kVWZvLnN0b3AoKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuUHJvYmUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgaWYgKHRoaXMuc3ByaXRlUHJvYmUucm90YXRpb24gPj0gdGhpcy5yb3RNYXggfHxcbiAgICAgICAgdGhpcy5zcHJpdGVQcm9iZS5yb3RhdGlvbiA8PSAodGhpcy5yb3RNYXggKiAtMSkpIHtcbiAgICAgICAgdGhpcy5yb3RJbmMgPSB0aGlzLnJvdEluYyAqIC0xO1xuICAgIH1cbiAgICB0aGlzLnNwcml0ZVByb2JlLnJvdGF0aW9uICs9IHRoaXMucm90SW5jO1xuXG4gICAgaWYgKHRoaXMuZGVidWcpIHtcbiAgICAgICAgdmFyIHByb2JlID0gdGhpcztcbiAgICAgICAgdGhpcy5jb2xsaXNpb25Hcm91cC5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICAgICBwcm9iZS5nYW1lLmRlYnVnLmJvZHkoY2hpbGQpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG50b290Lm9ic3RhY2xlLlByb2JlLnByb3RvdHlwZS5nZXRDb2xsaWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25Hcm91cDtcbn07XG4iLCJcbnRvb3Qub2JzdGFjbGUuU2F1Y2VyID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG5cbiAgICB0aGlzLnNwcml0ZVNhdWNlciA9IG51bGw7XG4gICAgdGhpcy5jb2xsaXNpb25Hcm91cCA9IG51bGw7XG5cbiAgICB0aGlzLnZlbG9jaXR5ID0gMzAwO1xuICAgIHRoaXMucm90TWF4ID0gMC4wMjU7XG4gICAgdGhpcy5yb3RJbmMgPSAwLjAwMjU7XG5cbiAgICB0aGlzLmRlYnVnID0gZmFsc2U7XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLnNwcml0ZXNoZWV0KCdzYXVjZXInLCAnaW1hZ2VzL3NhdWNlci1zcHJpdGVzaGVldC5wbmcnLCAyNzYsIDEwMCk7XG5cbiAgICB0aGlzLmdhbWUubG9hZC5hdWRpbygndWZvJywgJ3NvdW5kcy91Zm8tMDEud2F2Jyk7XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgY29uc29sZS5sb2coJ3Jlc2V0dGluZyBzYXVjZXIgdG8gJyArIHggKyAnLCAnICsgeSk7XG4gICAgdGhpcy5jb2xsaXNpb25Hcm91cC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaXRlbS5yZXNldCh4LCB5KTtcbiAgICB9KTtcbiAgICB0aGlzLmNvbGxpc2lvbkdyb3VwLnNldEFsbCgnYm9keS52ZWxvY2l0eS54JywgdGhpcy52ZWxvY2l0eSAqIC0xKTtcblxuICAgIHRoaXMuc291bmRVZm8ucGxheSgnJywgMCwgMSwgdHJ1ZSwgZmFsc2UpO1xufTtcblxudG9vdC5vYnN0YWNsZS5TYXVjZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcblxuICAgIHRoaXMuc291bmRVZm8gPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCd1Zm8nKTtcbiAgICB0aGlzLnNvdW5kVWZvLmFsbG93TXVsdGlwbGUgPSBmYWxzZTtcblxuICAgIHRoaXMuY29sbGlzaW9uR3JvdXAgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZSh0aGlzLmNvbGxpc2lvbkdyb3VwKTtcbiAgICAvL3RoaXMuY29sbGlzaW9uR3JvdXAuYm9keS5hbGxvd0dyYXZpdHkgPSBmYWxzZTtcbiAgICAvL3RoaXMuY29sbGlzaW9uR3JvdXAuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIHRoaXMuY29sbGlzaW9uR3JvdXAuY2hlY2tXb3JsZEJvdW5kcyA9IHRydWU7XG5cbiAgICAvL3RoaXMuc3ByaXRlU2F1Y2VyID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUodywgMTI4LCAnc2F1Y2VyJyk7XG4gICAgdGhpcy5zcHJpdGVTYXVjZXIgPSB0aGlzLmNvbGxpc2lvbkdyb3VwLmNyZWF0ZSh3LCAxMjgsICdzYXVjZXInKTtcbiAgICB0aGlzLnNwcml0ZVNhdWNlci5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5zcHJpdGVTYXVjZXIpO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLmJvZHkuYWxsb3dHcmF2aXR5ID0gZmFsc2U7XG4gICAgdGhpcy5zcHJpdGVTYXVjZXIuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLmJvZHkuc2V0U2l6ZSg2NCwgMjAsIC0xMCwgLTM3KTtcblxuICAgIC8vIEFkZGl0aW9uYWwgY29sbGlkZXIgYm94ZXMgdG8gbWF0Y2ggdGhlIHNoYXBlIG9mIHRoZSBzYXVjZXIgbW9yZSBjbG9zZWx5XG4gICAgdmFyIGMxID0gdGhpcy5jb2xsaXNpb25Hcm91cC5jcmVhdGUodywgMTI4LCAnJyk7XG4gICAgYzEuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKGMxKTtcbiAgICBjMS5ib2R5LmFsbG93R3Jhdml0eSA9IGZhbHNlO1xuICAgIGMxLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcbiAgICBjMS5ib2R5LnNldFNpemUoMjAwLCAyMiwgLTQsIC0xNik7XG5cbiAgICB2YXIgYzIgPSB0aGlzLmNvbGxpc2lvbkdyb3VwLmNyZWF0ZSh3LCAxMjgsICcnKTtcbiAgICBjMi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUoYzIpO1xuICAgIGMyLmJvZHkuYWxsb3dHcmF2aXR5ID0gZmFsc2U7XG4gICAgYzIuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIGMyLmJvZHkuc2V0U2l6ZSgyNzAsIDMyLCAtNCwgMTEpO1xuXG4gICAgdmFyIGMzID0gdGhpcy5jb2xsaXNpb25Hcm91cC5jcmVhdGUodywgMTI4LCAnJyk7XG4gICAgYzMuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKGMzKTtcbiAgICBjMy5hbGxvd0dyYXZpdHkgPSBmYWxzZTtcbiAgICBjMy5ib2R5LmltbW92YWJsZSA9IHRydWU7XG4gICAgYzMuYm9keS5zZXRTaXplKDIwMCwgMTYsIC00LCAzNSk7XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUuaW5Xb3JsZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNwcml0ZVNhdWNlci5pbldvcmxkO1xufTtcblxudG9vdC5vYnN0YWNsZS5TYXVjZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNvdW5kVWZvLnN0b3AoKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuU2F1Y2VyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgIGlmICh0aGlzLnNwcml0ZVNhdWNlci5yb3RhdGlvbiA+PSB0aGlzLnJvdE1heCB8fFxuICAgICAgICB0aGlzLnNwcml0ZVNhdWNlci5yb3RhdGlvbiA8PSAodGhpcy5yb3RNYXggKiAtMSkpIHtcbiAgICAgICAgdGhpcy5yb3RJbmMgPSB0aGlzLnJvdEluYyAqIC0xO1xuICAgIH1cbiAgICB0aGlzLnNwcml0ZVNhdWNlci5yb3RhdGlvbiArPSB0aGlzLnJvdEluYztcblxuICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICAgIHZhciBzYXVjZXIgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbkdyb3VwLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgIHNhdWNlci5nYW1lLmRlYnVnLmJvZHkoY2hpbGQpO1xuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sbGlzaW9uR3JvdXA7XG59O1xuIiwidG9vdC51aS5EaXN0YW5jZSA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xufTtcblxudG9vdC51aS5EaXN0YW5jZS5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xufTtcblxudG9vdC51aS5EaXN0YW5jZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdGhpcy5kaXNwbGF5ID0gdGhpcy5nYW1lLmFkZC50ZXh0KDE2LCAxNiwgJ2Rpc3RhbmNlOiAwJywge1xuICAgICAgICBmb250U2l6ZTogJzMycHgnLCBmaWxsOiAnI2ZmZidcbiAgICB9KTtcbn07XG5cbnRvb3QudWkuRGlzdGFuY2UucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZGlzcGxheS50ZXh0ID0gJ2Rpc3RhbmNlOiAnICsgTWF0aC5yb3VuZCh0b290LmN1cnJlbnREaXN0YW5jZSAvIDEwKTtcbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=