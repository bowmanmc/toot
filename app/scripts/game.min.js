var toot = {
    //gravity: (300 * 0.27),
    gravity: 300,
    fartStrength: 250,
    currentDistance: 0,

    // namespacing
    character: {},
    environment: {},
    obstacle: {},
    ui: {}
};



var run = function() {

    var stats = new Stats();
    document.body.appendChild(stats.domElement);
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0px';

    var game = new Phaser.Game(
        1334, 750,
        Phaser.AUTO,
        '', {
            preload: preload,
            create: create,
            update: update
        });

    //var cursors;
    var player = new toot.character.Player(game);
    var ground = new toot.environment.Ground(game);
    var background = new toot.environment.Background(game);

    var obstacleGenerator = new toot.obstacle.Generator(game);
    var uiDistance = new toot.ui.Distance(game);

    var vignette = new toot.environment.Vignette(game);


    function preload () {
        background.preload();
        ground.preload();
        player.preload();
        vignette.preload();

        obstacleGenerator.preload();

        uiDistance.preload();
    }

    function create () {

        game.physics.startSystem(Phaser.Physics.ARCADE);

        game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        game.scale.pageAlignHorizontally = true;
        game.scale.pageAlignVertically = true;
        game.scale.setScreenSize(true);
        game.scale.refresh();

        // Create game objects
        background.create();
        ground.create();
        player.create();


        obstacleGenerator.create();

        uiDistance.create();

        vignette.create();
    }

    function update() {
        stats.begin();

        game.physics.arcade.collide(player.getColliders(), ground.getColliders());

        background.update();
        ground.update();
        player.update();

        obstacleGenerator.update();

        uiDistance.update();

        toot.currentDistance++;

        stats.end();
    }

};


toot.environment.Background = function(game) {
    this.game = game;
};

toot.environment.Background.prototype.preload = function() {
    this.game.load.image('bg-space', 'images/bg-space.jpg');
    this.game.load.image('bg-stars-small', 'images/bg-stars-small.png');
    this.game.load.image('bg-stars-large', 'images/bg-stars-large.png');
};

toot.environment.Background.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.spaceBg = this.game.add.tileSprite(0, 0, w, h, 'bg-space');
    this.starsSm = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-small');
    this.starsLg = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-large');
};

toot.environment.Background.prototype.update = function() {
    this.spaceBg.tilePosition.x -= 0.1;
    this.starsSm.tilePosition.x -= 0.2;
    this.starsLg.tilePosition.x -= 0.3;

};


toot.environment.Ground = function(game) {
    this.game = game;
};

toot.environment.Ground.prototype.preload = function() {
    this.game.load.image('ground', 'images/ground.jpg');
};

toot.environment.Ground.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    var yPos = h - 64;
    this.ground = this.game.add.tileSprite(0, yPos, w, h, 'ground');

    this.game.physics.arcade.enable(this.ground);
    this.ground.body.immovable = true;

    // bug in phaser 2.3.0
    // see: http://www.html5gamedevs.com/topic/13856-problem-with-collide-method-from-physics-arcade-in-different-versions-of-phaser/?p=79032
    this.ground.physicsType = Phaser.SPRITE;
};

toot.environment.Ground.prototype.update = function() {
    this.ground.tilePosition.x -= 1.25;
};

toot.environment.Ground.prototype.getColliders = function() {
    return this.ground;
};

toot.environment.Vignette = function(game) {
    this.game = game;
};

toot.environment.Vignette.prototype.preload = function() {
    this.game.load.image('vignette', 'images/vignette.png');
};

toot.environment.Vignette.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.v = this.game.add.sprite(0, 0, 'vignette');
};


toot.character.Player = function(game) {
    this.game = game;
    this.sprite = null;
};

toot.character.Player.prototype.preload = function() {
    this.game.load.spritesheet('dude', 'images/dude.png', 64, 96);
};

toot.character.Player.prototype.create = function() {
    // player
    var startX = this.game.world.width * 0.15;
    var startY = this.game.world.height - 256;

    this.sprite = this.game.add.sprite(startX, startY, 'dude');
    this.game.physics.arcade.enable(this.sprite);
    //this.sprite.body.bounce.y = 0.1;
    this.sprite.body.gravity.y = toot.gravity;
    this.sprite.body.collideWorldBounds = true;

    //this.sprite.animations.add('right', [5, 6, 7, 8], 10, true);
    this.sprite.animations.add('run', [5, 6, 7, 8], 5, true);
    this.sprite.animations.add('land', [5, 6, 7, 8], 3, true);
};

toot.character.Player.prototype.update = function(cursors) {
    //  Reset the players velocity (movement)
    this.sprite.body.velocity.x = 0;

    //console.log(this.sprite.body.velocity.y);

    if (this.game.input.activePointer.isDown) {
        this.sprite.body.velocity.y = toot.fartStrength * -1;
    }

    if (this.sprite.body.touching.down) {
        this.sprite.animations.play('run');
    }
    else if (this.sprite.body.velocity.y > 0 &&
             this.sprite.body.velocity.y > (toot.fartStrength * 0.66)) {
        this.sprite.animations.play('land');
    }
    else {
        this.sprite.frame = 8;
    }

};

toot.character.Player.prototype.getColliders = function() {
    return this.sprite;
};

toot.obstacle.Generator = function(game) {
    this.game = game;
};

toot.obstacle.Generator.prototype.preload = function() {
    this.game.load.image('rock', 'assets/diamond.png');
};

toot.obstacle.Generator.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    this.rock = this.game.add.sprite(w, h / 2, 'rock');
};

toot.obstacle.Generator.prototype.update = function() {
    this.rock.position.x -= 2.5;
};

toot.ui.Distance = function(game) {
    this.game = game;
};

toot.ui.Distance.prototype.preload = function() {
};

toot.ui.Distance.prototype.create = function() {
    var w = this.game.world.width;
    this.display = this.game.add.text(16, 16, 'distance: 0', {
        fontSize: '32px', fill: '#fff'
    });
};

toot.ui.Distance.prototype.update = function() {
    this.display.text = 'distance: ' + Math.round(toot.currentDistance / 10);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJlbnZpcm9ubWVudC9iYWNrZ3JvdW5kLmpzIiwiZW52aXJvbm1lbnQvZ3JvdW5kLmpzIiwiZW52aXJvbm1lbnQvdmlnbmV0dGUuanMiLCJjaGFyYWN0ZXIvcGxheWVyLmpzIiwib2JzdGFjbGUvZ2VuZXJhdG9yLmpzIiwidWkvZGlzdGFuY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2FtZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdG9vdCA9IHtcbiAgICAvL2dyYXZpdHk6ICgzMDAgKiAwLjI3KSxcbiAgICBncmF2aXR5OiAzMDAsXG4gICAgZmFydFN0cmVuZ3RoOiAyNTAsXG4gICAgY3VycmVudERpc3RhbmNlOiAwLFxuXG4gICAgLy8gbmFtZXNwYWNpbmdcbiAgICBjaGFyYWN0ZXI6IHt9LFxuICAgIGVudmlyb25tZW50OiB7fSxcbiAgICBvYnN0YWNsZToge30sXG4gICAgdWk6IHt9XG59O1xuXG5cblxudmFyIHJ1biA9IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIHN0YXRzID0gbmV3IFN0YXRzKCk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdGF0cy5kb21FbGVtZW50KTtcbiAgICBzdGF0cy5kb21FbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICBzdGF0cy5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICcwcHgnO1xuXG4gICAgdmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoXG4gICAgICAgIDEzMzQsIDc1MCxcbiAgICAgICAgUGhhc2VyLkFVVE8sXG4gICAgICAgICcnLCB7XG4gICAgICAgICAgICBwcmVsb2FkOiBwcmVsb2FkLFxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZVxuICAgICAgICB9KTtcblxuICAgIC8vdmFyIGN1cnNvcnM7XG4gICAgdmFyIHBsYXllciA9IG5ldyB0b290LmNoYXJhY3Rlci5QbGF5ZXIoZ2FtZSk7XG4gICAgdmFyIGdyb3VuZCA9IG5ldyB0b290LmVudmlyb25tZW50Lkdyb3VuZChnYW1lKTtcbiAgICB2YXIgYmFja2dyb3VuZCA9IG5ldyB0b290LmVudmlyb25tZW50LkJhY2tncm91bmQoZ2FtZSk7XG5cbiAgICB2YXIgb2JzdGFjbGVHZW5lcmF0b3IgPSBuZXcgdG9vdC5vYnN0YWNsZS5HZW5lcmF0b3IoZ2FtZSk7XG4gICAgdmFyIHVpRGlzdGFuY2UgPSBuZXcgdG9vdC51aS5EaXN0YW5jZShnYW1lKTtcblxuICAgIHZhciB2aWduZXR0ZSA9IG5ldyB0b290LmVudmlyb25tZW50LlZpZ25ldHRlKGdhbWUpO1xuXG5cbiAgICBmdW5jdGlvbiBwcmVsb2FkICgpIHtcbiAgICAgICAgYmFja2dyb3VuZC5wcmVsb2FkKCk7XG4gICAgICAgIGdyb3VuZC5wcmVsb2FkKCk7XG4gICAgICAgIHBsYXllci5wcmVsb2FkKCk7XG4gICAgICAgIHZpZ25ldHRlLnByZWxvYWQoKTtcblxuICAgICAgICBvYnN0YWNsZUdlbmVyYXRvci5wcmVsb2FkKCk7XG5cbiAgICAgICAgdWlEaXN0YW5jZS5wcmVsb2FkKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlICgpIHtcblxuICAgICAgICBnYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcblxuICAgICAgICBnYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICAgIGdhbWUuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5zY2FsZS5wYWdlQWxpZ25WZXJ0aWNhbGx5ID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgICAgICBnYW1lLnNjYWxlLnJlZnJlc2goKTtcblxuICAgICAgICAvLyBDcmVhdGUgZ2FtZSBvYmplY3RzXG4gICAgICAgIGJhY2tncm91bmQuY3JlYXRlKCk7XG4gICAgICAgIGdyb3VuZC5jcmVhdGUoKTtcbiAgICAgICAgcGxheWVyLmNyZWF0ZSgpO1xuXG5cbiAgICAgICAgb2JzdGFjbGVHZW5lcmF0b3IuY3JlYXRlKCk7XG5cbiAgICAgICAgdWlEaXN0YW5jZS5jcmVhdGUoKTtcblxuICAgICAgICB2aWduZXR0ZS5jcmVhdGUoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgICAgIHN0YXRzLmJlZ2luKCk7XG5cbiAgICAgICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5jb2xsaWRlKHBsYXllci5nZXRDb2xsaWRlcnMoKSwgZ3JvdW5kLmdldENvbGxpZGVycygpKTtcblxuICAgICAgICBiYWNrZ3JvdW5kLnVwZGF0ZSgpO1xuICAgICAgICBncm91bmQudXBkYXRlKCk7XG4gICAgICAgIHBsYXllci51cGRhdGUoKTtcblxuICAgICAgICBvYnN0YWNsZUdlbmVyYXRvci51cGRhdGUoKTtcblxuICAgICAgICB1aURpc3RhbmNlLnVwZGF0ZSgpO1xuXG4gICAgICAgIHRvb3QuY3VycmVudERpc3RhbmNlKys7XG5cbiAgICAgICAgc3RhdHMuZW5kKCk7XG4gICAgfVxuXG59O1xuIiwiXG50b290LmVudmlyb25tZW50LkJhY2tncm91bmQgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuQmFja2dyb3VuZC5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1zcGFjZScsICdpbWFnZXMvYmctc3BhY2UuanBnJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2JnLXN0YXJzLXNtYWxsJywgJ2ltYWdlcy9iZy1zdGFycy1zbWFsbC5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctc3RhcnMtbGFyZ2UnLCAnaW1hZ2VzL2JnLXN0YXJzLWxhcmdlLnBuZycpO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5CYWNrZ3JvdW5kLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aDtcbiAgICB2YXIgaCA9IHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQ7XG4gICAgdGhpcy5zcGFjZUJnID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1zcGFjZScpO1xuICAgIHRoaXMuc3RhcnNTbSA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB3LCBoLCAnYmctc3RhcnMtc21hbGwnKTtcbiAgICB0aGlzLnN0YXJzTGcgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLXN0YXJzLWxhcmdlJyk7XG59O1xuXG50b290LmVudmlyb25tZW50LkJhY2tncm91bmQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3BhY2VCZy50aWxlUG9zaXRpb24ueCAtPSAwLjE7XG4gICAgdGhpcy5zdGFyc1NtLnRpbGVQb3NpdGlvbi54IC09IDAuMjtcbiAgICB0aGlzLnN0YXJzTGcudGlsZVBvc2l0aW9uLnggLT0gMC4zO1xuXG59O1xuIiwiXG50b290LmVudmlyb25tZW50Lkdyb3VuZCA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnZ3JvdW5kJywgJ2ltYWdlcy9ncm91bmQuanBnJyk7XG59O1xuXG50b290LmVudmlyb25tZW50Lkdyb3VuZC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdmFyIGggPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0O1xuXG4gICAgdmFyIHlQb3MgPSBoIC0gNjQ7XG4gICAgdGhpcy5ncm91bmQgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgeVBvcywgdywgaCwgJ2dyb3VuZCcpO1xuXG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZSh0aGlzLmdyb3VuZCk7XG4gICAgdGhpcy5ncm91bmQuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuXG4gICAgLy8gYnVnIGluIHBoYXNlciAyLjMuMFxuICAgIC8vIHNlZTogaHR0cDovL3d3dy5odG1sNWdhbWVkZXZzLmNvbS90b3BpYy8xMzg1Ni1wcm9ibGVtLXdpdGgtY29sbGlkZS1tZXRob2QtZnJvbS1waHlzaWNzLWFyY2FkZS1pbi1kaWZmZXJlbnQtdmVyc2lvbnMtb2YtcGhhc2VyLz9wPTc5MDMyXG4gICAgdGhpcy5ncm91bmQucGh5c2ljc1R5cGUgPSBQaGFzZXIuU1BSSVRFO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ3JvdW5kLnRpbGVQb3NpdGlvbi54IC09IDEuMjU7XG59O1xuXG50b290LmVudmlyb25tZW50Lkdyb3VuZC5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ3JvdW5kO1xufTtcbiIsInRvb3QuZW52aXJvbm1lbnQuVmlnbmV0dGUgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuVmlnbmV0dGUucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgndmlnbmV0dGUnLCAnaW1hZ2VzL3ZpZ25ldHRlLnBuZycpO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5WaWduZXR0ZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdmFyIGggPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0O1xuICAgIHRoaXMudiA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDAsIDAsICd2aWduZXR0ZScpO1xufTtcbiIsIlxudG9vdC5jaGFyYWN0ZXIuUGxheWVyID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgdGhpcy5zcHJpdGUgPSBudWxsO1xufTtcblxudG9vdC5jaGFyYWN0ZXIuUGxheWVyLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLmxvYWQuc3ByaXRlc2hlZXQoJ2R1ZGUnLCAnaW1hZ2VzL2R1ZGUucG5nJywgNjQsIDk2KTtcbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gcGxheWVyXG4gICAgdmFyIHN0YXJ0WCA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aCAqIDAuMTU7XG4gICAgdmFyIHN0YXJ0WSA9IHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQgLSAyNTY7XG5cbiAgICB0aGlzLnNwcml0ZSA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHN0YXJ0WCwgc3RhcnRZLCAnZHVkZScpO1xuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5zcHJpdGUpO1xuICAgIC8vdGhpcy5zcHJpdGUuYm9keS5ib3VuY2UueSA9IDAuMTtcbiAgICB0aGlzLnNwcml0ZS5ib2R5LmdyYXZpdHkueSA9IHRvb3QuZ3Jhdml0eTtcbiAgICB0aGlzLnNwcml0ZS5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWU7XG5cbiAgICAvL3RoaXMuc3ByaXRlLmFuaW1hdGlvbnMuYWRkKCdyaWdodCcsIFs1LCA2LCA3LCA4XSwgMTAsIHRydWUpO1xuICAgIHRoaXMuc3ByaXRlLmFuaW1hdGlvbnMuYWRkKCdydW4nLCBbNSwgNiwgNywgOF0sIDUsIHRydWUpO1xuICAgIHRoaXMuc3ByaXRlLmFuaW1hdGlvbnMuYWRkKCdsYW5kJywgWzUsIDYsIDcsIDhdLCAzLCB0cnVlKTtcbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oY3Vyc29ycykge1xuICAgIC8vICBSZXNldCB0aGUgcGxheWVycyB2ZWxvY2l0eSAobW92ZW1lbnQpXG4gICAgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS54ID0gMDtcblxuICAgIC8vY29uc29sZS5sb2codGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS55KTtcblxuICAgIGlmICh0aGlzLmdhbWUuaW5wdXQuYWN0aXZlUG9pbnRlci5pc0Rvd24pIHtcbiAgICAgICAgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS55ID0gdG9vdC5mYXJ0U3RyZW5ndGggKiAtMTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zcHJpdGUuYm9keS50b3VjaGluZy5kb3duKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlLmFuaW1hdGlvbnMucGxheSgncnVuJyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkueSA+IDAgJiZcbiAgICAgICAgICAgICB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5LnkgPiAodG9vdC5mYXJ0U3RyZW5ndGggKiAwLjY2KSkge1xuICAgICAgICB0aGlzLnNwcml0ZS5hbmltYXRpb25zLnBsYXkoJ2xhbmQnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lID0gODtcbiAgICB9XG5cbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3ByaXRlO1xufTtcbiIsInRvb3Qub2JzdGFjbGUuR2VuZXJhdG9yID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdyb2NrJywgJ2Fzc2V0cy9kaWFtb25kLnBuZycpO1xufTtcblxudG9vdC5vYnN0YWNsZS5HZW5lcmF0b3IucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcblxuICAgIHRoaXMucm9jayA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHcsIGggLyAyLCAncm9jaycpO1xufTtcblxudG9vdC5vYnN0YWNsZS5HZW5lcmF0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucm9jay5wb3NpdGlvbi54IC09IDIuNTtcbn07XG4iLCJ0b290LnVpLkRpc3RhbmNlID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG59O1xuXG50b290LnVpLkRpc3RhbmNlLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG59O1xuXG50b290LnVpLkRpc3RhbmNlLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aDtcbiAgICB0aGlzLmRpc3BsYXkgPSB0aGlzLmdhbWUuYWRkLnRleHQoMTYsIDE2LCAnZGlzdGFuY2U6IDAnLCB7XG4gICAgICAgIGZvbnRTaXplOiAnMzJweCcsIGZpbGw6ICcjZmZmJ1xuICAgIH0pO1xufTtcblxudG9vdC51aS5EaXN0YW5jZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5kaXNwbGF5LnRleHQgPSAnZGlzdGFuY2U6ICcgKyBNYXRoLnJvdW5kKHRvb3QuY3VycmVudERpc3RhbmNlIC8gMTApO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==