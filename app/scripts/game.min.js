var toot = {
    //gravity: (300 * 0.27),
    gravity: 300,
    fartStrength: 250,
    currentDistance: 0,

    // namespacing
    character: {},
    environment: {},
    obstacle: {},
    ui: {}
};



var run = function() {

    var stats = new Stats();
    document.body.appendChild(stats.domElement);
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0px';

    var game = new Phaser.Game(
        1334, 750,
        Phaser.AUTO,
        '', {
            preload: preload,
            create: create,
            update: update
        });

    //var cursors;
    var player = new toot.character.Player(game);

    var ground = new toot.environment.Ground(game);
    var background = new toot.environment.Background(game);

    var uiDistance = new toot.ui.Distance(game);

    var vignette = new toot.environment.Vignette(game);

    var obstacles = new toot.obstacle.Generator(game);

    function preload () {
        background.preload();
        ground.preload();
        player.preload();
        vignette.preload();

        obstacles.preload();

        uiDistance.preload();
    }

    function create () {

        game.physics.startSystem(Phaser.Physics.ARCADE);
        //game.physics.startSystem(Phaser.Physics.NINJA);
        //game.physics.startSystem(Phaser.Physics.P2JS);

        game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
        game.scale.pageAlignHorizontally = true;
        game.scale.pageAlignVertically = true;
        game.scale.setScreenSize(true);
        game.scale.refresh();

        // Create game objects
        background.create();
        ground.create();
        player.create();


        obstacles.create();

        //uiDistance.create();

        vignette.create();
    }

    function collisionHandler(toot, obstacle) {
        console.log('collision detected!');
    }

    function update() {
        stats.begin();

        game.physics.arcade.collide(player.getColliders(), ground.getColliders());
        game.physics.arcade.collide(player.getColliders(), obstacles.getColliders(), collisionHandler, null, this);

        game.debug.bodyInfo(player.getColliders(), 32, 32);
        game.debug.bodyInfo(obstacles.getColliders(), 32, 256);
        //game.debug.body(obstacles.getColliders());
        game.debug.body(player.getColliders());

        background.update();
        ground.update();
        player.update();

        obstacles.update();

        //uiDistance.update();

        toot.currentDistance++;

        stats.end();
    }

};


toot.character.Player = function(game) {
    this.game = game;
    this.spriteToot = null;
    this.spriteBlast = null;
};

toot.character.Player.prototype.preload = function() {
    this.game.load.spritesheet('toot', 'images/toot-spritesheet.png', 64, 96);
    this.game.load.spritesheet('blast', 'images/blast-spritesheet.png', 60, 63);

    this.game.load.audio('fart', 'sounds/fart-02.wav');
};

toot.character.Player.prototype.create = function() {
    // player
    var startX = this.game.world.width * 0.15;
    var startY = this.game.world.height - 256;

    this.spriteToot = this.game.add.sprite(startX, startY, 'toot');
    this.game.physics.arcade.enable(this.spriteToot);

    this.spriteToot.body.gravity.y = toot.gravity;
    this.spriteToot.body.collideWorldBounds = true;

    this.spriteToot.animations.add('run', [5, 6, 7, 8], 6, true);
    this.spriteToot.animations.add('land', [5, 6, 7, 8], 2, true);

    // blast
    this.spriteBlast = this.game.add.sprite(startX - 60, startY + 60, 'blast');
    this.spriteBlast.animations.add('fart', [1, 3, 4, 4, 0], 10, false);

    this.soundFart = this.game.add.audio('fart');
    this.soundFart.allowMultiple = false;
};

toot.character.Player.prototype.update = function(cursors) {
    //  Reset the players velocity (movement)
    this.spriteToot.body.velocity.x = 0;

    //console.log(this.sprite.body.velocity.y);

    if (this.game.input.activePointer.isDown) {
        this.spriteToot.body.velocity.y = toot.fartStrength * -1;
        this.spriteBlast.animations.play('fart');
        //this.soundFart.play('', 0.35, 1, false, false);
        this.soundFart.play('', 0, 1, false, false);
    }
    if (this.spriteToot.body.touching.down) {
        this.spriteToot.animations.play('run');
        this.spriteBlast.frame = 0;
    }
    else if (this.spriteToot.body.velocity.y > 0 &&
             this.spriteToot.body.velocity.y > (toot.fartStrength * 0.66)) {
        this.spriteToot.animations.play('land');
    }
    else {
        this.spriteToot.frame = 4;
    }

    this.spriteBlast.position.x = this.spriteToot.position.x - 38;
    this.spriteBlast.position.y = this.spriteToot.position.y + 80;
};

toot.character.Player.prototype.getColliders = function() {
    return this.spriteToot;
};


toot.environment.Background = function(game) {
    this.game = game;
};

toot.environment.Background.prototype.preload = function() {
    this.game.load.image('bg-space', 'images/bg-space.jpg');
    this.game.load.image('bg-stars-small', 'images/bg-stars-small.png');
    this.game.load.image('bg-stars-dense', 'images/bg-stars-small-dense.png');
    this.game.load.image('bg-stars-large', 'images/bg-stars-large.png');

    this.game.load.image('bg-horizon', 'images/bg-horizon-gradient.png');
    this.game.load.image('bg-mountains-01', 'images/bg-mountains-01.png');
    this.game.load.image('bg-mountains-02', 'images/bg-mountains-02.png');
};

toot.environment.Background.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.spaceBg = this.game.add.tileSprite(0, 0, w, h, 'bg-space');
    this.starsLg = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-large');
    this.spaceDs = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-dense');
    this.starsSm = this.game.add.tileSprite(0, 0, w, h, 'bg-stars-small');

    this.horizon = this.game.add.tileSprite(0, 0, w, h, 'bg-horizon');

    this.mountains1 = this.game.add.tileSprite(0, 0, w, h, 'bg-mountains-01');
    this.mountains2 = this.game.add.tileSprite(0, 0, w, h, 'bg-mountains-02');
};

toot.environment.Background.prototype.update = function() {
    this.spaceBg.tilePosition.x -= 0.075;
    this.starsLg.tilePosition.x -= 0.100;
    this.spaceDs.tilePosition.x -= 0.125;
    this.starsSm.tilePosition.x -= 0.150;

    this.mountains1.tilePosition.x -= 0.20;
    this.mountains2.tilePosition.x -= 0.25;
};


toot.environment.Ground = function(game) {
    this.game = game;
};

toot.environment.Ground.prototype.preload = function() {
    this.game.load.image('ground', 'images/ground.jpg');
};

toot.environment.Ground.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    var yPos = h - 97;
    this.ground = this.game.add.tileSprite(0, yPos, w, h, 'ground');

    this.game.physics.arcade.enable(this.ground);
    this.ground.body.immovable = true;

    // bug in phaser 2.3.0
    // see: http://www.html5gamedevs.com/topic/13856-problem-with-collide-method-from-physics-arcade-in-different-versions-of-phaser/?p=79032
    this.ground.physicsType = Phaser.SPRITE;
};

toot.environment.Ground.prototype.update = function() {
    this.ground.tilePosition.x -= 0.85;
};

toot.environment.Ground.prototype.getColliders = function() {
    return this.ground;
};

toot.environment.Vignette = function(game) {
    this.game = game;
};

toot.environment.Vignette.prototype.preload = function() {
    this.game.load.image('vignette', 'images/vignette.png');
};

toot.environment.Vignette.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;
    this.v = this.game.add.sprite(0, 0, 'vignette');
};

toot.obstacle.Generator = function(game) {
    this.game = game;
    this.saucer = new toot.obstacle.Saucer(this.game);
};

toot.obstacle.Generator.prototype.preload = function() {
    this.saucer.preload();
};

toot.obstacle.Generator.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    //this.rock = this.game.add.sprite(w, h / 2, 'rock');
    this.saucer.create();

};

toot.obstacle.Generator.prototype.update = function() {
    this.saucer.update();
};

toot.obstacle.Generator.prototype.getColliders = function() {
    return this.saucer.getColliders();
};


toot.obstacle.Saucer = function(game) {
    this.game = game;
    this.spriteSaucer = null;
    this.collisionGroup = null;

    this.velocity = 300;
};

toot.obstacle.Saucer.prototype.preload = function() {
    this.game.load.spritesheet('saucer', 'images/saucer-spritesheet.png', 276, 100);
};

toot.obstacle.Saucer.prototype.reset = function() {
    var x = this.game.world.width - 100;
    var miny = 7;
    var maxy = this.game.world.height - 225;

    var y = this.game.rnd.integerInRange(miny, maxy);

    console.log('resetting saucer to ' + x + ', ' + y);
    this.spriteSaucer.reset(x, y);
    this.spriteSaucer.body.velocity.x = this.velocity * -1;

    this.s2.reset(x, y);
    this.s2.body.velocity.x = this.velocity * -1;
};

toot.obstacle.Saucer.prototype.create = function() {
    var w = this.game.world.width;
    var h = this.game.world.height;

    this.collisionGroup = this.game.add.group();
    this.game.physics.arcade.enable(this.collisionGroup);
    //this.collisionGroup.body.allowGravity = false;
    //this.collisionGroup.body.immovable = true;
    //
    this.collisionGroup.checkWorldBounds = true;

    //this.spriteSaucer = this.game.add.sprite(w, 128, 'saucer');
    this.spriteSaucer = this.collisionGroup.create(w, 128, 'saucer');
    //this.spriteSaucer.anchor.setTo(0.5, 0.5);
    this.game.physics.arcade.enable(this.spriteSaucer);
    this.spriteSaucer.body.allowGravity = false;
    this.spriteSaucer.body.immovable = true;
    this.spriteSaucer.body.setSize(64, 32, 97, 6);

    //this.s2 = this.game.add.sprite(w, 128, '');
    this.s2 = this.collisionGroup.create(w, 128, '');
    this.game.physics.arcade.enable(this.s2);
    this.s2.body.allowGravity = false;
    this.s2.body.immovable = true;
    this.s2.body.setSize(267, 62, 0, 32);

    this.reset();
};

toot.obstacle.Saucer.prototype.update = function() {
    if (!this.spriteSaucer.inWorld) {
        console.log('saucer is off world!');
        this.reset();
    }
    this.game.debug.body(this.spriteSaucer);
    this.game.debug.body(this.s2);
};

toot.obstacle.Saucer.prototype.getColliders = function() {
    return this.collisionGroup;
};

toot.ui.Distance = function(game) {
    this.game = game;
};

toot.ui.Distance.prototype.preload = function() {
};

toot.ui.Distance.prototype.create = function() {
    var w = this.game.world.width;
    this.display = this.game.add.text(16, 16, 'distance: 0', {
        fontSize: '32px', fill: '#fff'
    });
};

toot.ui.Distance.prototype.update = function() {
    this.display.text = 'distance: ' + Math.round(toot.currentDistance / 10);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJjaGFyYWN0ZXIvcGxheWVyLmpzIiwiZW52aXJvbm1lbnQvYmFja2dyb3VuZC5qcyIsImVudmlyb25tZW50L2dyb3VuZC5qcyIsImVudmlyb25tZW50L3ZpZ25ldHRlLmpzIiwib2JzdGFjbGUvZ2VuZXJhdG9yLmpzIiwib2JzdGFjbGUvc2F1Y2VyLmpzIiwidWkvZGlzdGFuY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnYW1lLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB0b290ID0ge1xuICAgIC8vZ3Jhdml0eTogKDMwMCAqIDAuMjcpLFxuICAgIGdyYXZpdHk6IDMwMCxcbiAgICBmYXJ0U3RyZW5ndGg6IDI1MCxcbiAgICBjdXJyZW50RGlzdGFuY2U6IDAsXG5cbiAgICAvLyBuYW1lc3BhY2luZ1xuICAgIGNoYXJhY3Rlcjoge30sXG4gICAgZW52aXJvbm1lbnQ6IHt9LFxuICAgIG9ic3RhY2xlOiB7fSxcbiAgICB1aToge31cbn07XG5cblxuXG52YXIgcnVuID0gZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN0YXRzLmRvbUVsZW1lbnQpO1xuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzBweCc7XG5cbiAgICB2YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZShcbiAgICAgICAgMTMzNCwgNzUwLFxuICAgICAgICBQaGFzZXIuQVVUTyxcbiAgICAgICAgJycsIHtcbiAgICAgICAgICAgIHByZWxvYWQ6IHByZWxvYWQsXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXG4gICAgICAgIH0pO1xuXG4gICAgLy92YXIgY3Vyc29ycztcbiAgICB2YXIgcGxheWVyID0gbmV3IHRvb3QuY2hhcmFjdGVyLlBsYXllcihnYW1lKTtcblxuICAgIHZhciBncm91bmQgPSBuZXcgdG9vdC5lbnZpcm9ubWVudC5Hcm91bmQoZ2FtZSk7XG4gICAgdmFyIGJhY2tncm91bmQgPSBuZXcgdG9vdC5lbnZpcm9ubWVudC5CYWNrZ3JvdW5kKGdhbWUpO1xuXG4gICAgdmFyIHVpRGlzdGFuY2UgPSBuZXcgdG9vdC51aS5EaXN0YW5jZShnYW1lKTtcblxuICAgIHZhciB2aWduZXR0ZSA9IG5ldyB0b290LmVudmlyb25tZW50LlZpZ25ldHRlKGdhbWUpO1xuXG4gICAgdmFyIG9ic3RhY2xlcyA9IG5ldyB0b290Lm9ic3RhY2xlLkdlbmVyYXRvcihnYW1lKTtcblxuICAgIGZ1bmN0aW9uIHByZWxvYWQgKCkge1xuICAgICAgICBiYWNrZ3JvdW5kLnByZWxvYWQoKTtcbiAgICAgICAgZ3JvdW5kLnByZWxvYWQoKTtcbiAgICAgICAgcGxheWVyLnByZWxvYWQoKTtcbiAgICAgICAgdmlnbmV0dGUucHJlbG9hZCgpO1xuXG4gICAgICAgIG9ic3RhY2xlcy5wcmVsb2FkKCk7XG5cbiAgICAgICAgdWlEaXN0YW5jZS5wcmVsb2FkKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlICgpIHtcblxuICAgICAgICBnYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcbiAgICAgICAgLy9nYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuTklOSkEpO1xuICAgICAgICAvL2dhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5QMkpTKTtcblxuICAgICAgICBnYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICAgIGdhbWUuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5zY2FsZS5wYWdlQWxpZ25WZXJ0aWNhbGx5ID0gdHJ1ZTtcbiAgICAgICAgZ2FtZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgICAgICBnYW1lLnNjYWxlLnJlZnJlc2goKTtcblxuICAgICAgICAvLyBDcmVhdGUgZ2FtZSBvYmplY3RzXG4gICAgICAgIGJhY2tncm91bmQuY3JlYXRlKCk7XG4gICAgICAgIGdyb3VuZC5jcmVhdGUoKTtcbiAgICAgICAgcGxheWVyLmNyZWF0ZSgpO1xuXG5cbiAgICAgICAgb2JzdGFjbGVzLmNyZWF0ZSgpO1xuXG4gICAgICAgIC8vdWlEaXN0YW5jZS5jcmVhdGUoKTtcblxuICAgICAgICB2aWduZXR0ZS5jcmVhdGUoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb2xsaXNpb25IYW5kbGVyKHRvb3QsIG9ic3RhY2xlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb2xsaXNpb24gZGV0ZWN0ZWQhJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgICBzdGF0cy5iZWdpbigpO1xuXG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuY29sbGlkZShwbGF5ZXIuZ2V0Q29sbGlkZXJzKCksIGdyb3VuZC5nZXRDb2xsaWRlcnMoKSk7XG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuY29sbGlkZShwbGF5ZXIuZ2V0Q29sbGlkZXJzKCksIG9ic3RhY2xlcy5nZXRDb2xsaWRlcnMoKSwgY29sbGlzaW9uSGFuZGxlciwgbnVsbCwgdGhpcyk7XG5cbiAgICAgICAgZ2FtZS5kZWJ1Zy5ib2R5SW5mbyhwbGF5ZXIuZ2V0Q29sbGlkZXJzKCksIDMyLCAzMik7XG4gICAgICAgIGdhbWUuZGVidWcuYm9keUluZm8ob2JzdGFjbGVzLmdldENvbGxpZGVycygpLCAzMiwgMjU2KTtcbiAgICAgICAgLy9nYW1lLmRlYnVnLmJvZHkob2JzdGFjbGVzLmdldENvbGxpZGVycygpKTtcbiAgICAgICAgZ2FtZS5kZWJ1Zy5ib2R5KHBsYXllci5nZXRDb2xsaWRlcnMoKSk7XG5cbiAgICAgICAgYmFja2dyb3VuZC51cGRhdGUoKTtcbiAgICAgICAgZ3JvdW5kLnVwZGF0ZSgpO1xuICAgICAgICBwbGF5ZXIudXBkYXRlKCk7XG5cbiAgICAgICAgb2JzdGFjbGVzLnVwZGF0ZSgpO1xuXG4gICAgICAgIC8vdWlEaXN0YW5jZS51cGRhdGUoKTtcblxuICAgICAgICB0b290LmN1cnJlbnREaXN0YW5jZSsrO1xuXG4gICAgICAgIHN0YXRzLmVuZCgpO1xuICAgIH1cblxufTtcbiIsIlxudG9vdC5jaGFyYWN0ZXIuUGxheWVyID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgdGhpcy5zcHJpdGVUb290ID0gbnVsbDtcbiAgICB0aGlzLnNwcml0ZUJsYXN0ID0gbnVsbDtcbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLnNwcml0ZXNoZWV0KCd0b290JywgJ2ltYWdlcy90b290LXNwcml0ZXNoZWV0LnBuZycsIDY0LCA5Nik7XG4gICAgdGhpcy5nYW1lLmxvYWQuc3ByaXRlc2hlZXQoJ2JsYXN0JywgJ2ltYWdlcy9ibGFzdC1zcHJpdGVzaGVldC5wbmcnLCA2MCwgNjMpO1xuXG4gICAgdGhpcy5nYW1lLmxvYWQuYXVkaW8oJ2ZhcnQnLCAnc291bmRzL2ZhcnQtMDIud2F2Jyk7XG59O1xuXG50b290LmNoYXJhY3Rlci5QbGF5ZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8vIHBsYXllclxuICAgIHZhciBzdGFydFggPSB0aGlzLmdhbWUud29ybGQud2lkdGggKiAwLjE1O1xuICAgIHZhciBzdGFydFkgPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0IC0gMjU2O1xuXG4gICAgdGhpcy5zcHJpdGVUb290ID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoc3RhcnRYLCBzdGFydFksICd0b290Jyk7XG4gICAgdGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZSh0aGlzLnNwcml0ZVRvb3QpO1xuXG4gICAgdGhpcy5zcHJpdGVUb290LmJvZHkuZ3Jhdml0eS55ID0gdG9vdC5ncmF2aXR5O1xuICAgIHRoaXMuc3ByaXRlVG9vdC5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWU7XG5cbiAgICB0aGlzLnNwcml0ZVRvb3QuYW5pbWF0aW9ucy5hZGQoJ3J1bicsIFs1LCA2LCA3LCA4XSwgNiwgdHJ1ZSk7XG4gICAgdGhpcy5zcHJpdGVUb290LmFuaW1hdGlvbnMuYWRkKCdsYW5kJywgWzUsIDYsIDcsIDhdLCAyLCB0cnVlKTtcblxuICAgIC8vIGJsYXN0XG4gICAgdGhpcy5zcHJpdGVCbGFzdCA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHN0YXJ0WCAtIDYwLCBzdGFydFkgKyA2MCwgJ2JsYXN0Jyk7XG4gICAgdGhpcy5zcHJpdGVCbGFzdC5hbmltYXRpb25zLmFkZCgnZmFydCcsIFsxLCAzLCA0LCA0LCAwXSwgMTAsIGZhbHNlKTtcblxuICAgIHRoaXMuc291bmRGYXJ0ID0gdGhpcy5nYW1lLmFkZC5hdWRpbygnZmFydCcpO1xuICAgIHRoaXMuc291bmRGYXJ0LmFsbG93TXVsdGlwbGUgPSBmYWxzZTtcbn07XG5cbnRvb3QuY2hhcmFjdGVyLlBsYXllci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oY3Vyc29ycykge1xuICAgIC8vICBSZXNldCB0aGUgcGxheWVycyB2ZWxvY2l0eSAobW92ZW1lbnQpXG4gICAgdGhpcy5zcHJpdGVUb290LmJvZHkudmVsb2NpdHkueCA9IDA7XG5cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkueSk7XG5cbiAgICBpZiAodGhpcy5nYW1lLmlucHV0LmFjdGl2ZVBvaW50ZXIuaXNEb3duKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlVG9vdC5ib2R5LnZlbG9jaXR5LnkgPSB0b290LmZhcnRTdHJlbmd0aCAqIC0xO1xuICAgICAgICB0aGlzLnNwcml0ZUJsYXN0LmFuaW1hdGlvbnMucGxheSgnZmFydCcpO1xuICAgICAgICAvL3RoaXMuc291bmRGYXJ0LnBsYXkoJycsIDAuMzUsIDEsIGZhbHNlLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuc291bmRGYXJ0LnBsYXkoJycsIDAsIDEsIGZhbHNlLCBmYWxzZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNwcml0ZVRvb3QuYm9keS50b3VjaGluZy5kb3duKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlVG9vdC5hbmltYXRpb25zLnBsYXkoJ3J1bicpO1xuICAgICAgICB0aGlzLnNwcml0ZUJsYXN0LmZyYW1lID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5zcHJpdGVUb290LmJvZHkudmVsb2NpdHkueSA+IDAgJiZcbiAgICAgICAgICAgICB0aGlzLnNwcml0ZVRvb3QuYm9keS52ZWxvY2l0eS55ID4gKHRvb3QuZmFydFN0cmVuZ3RoICogMC42NikpIHtcbiAgICAgICAgdGhpcy5zcHJpdGVUb290LmFuaW1hdGlvbnMucGxheSgnbGFuZCcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5zcHJpdGVUb290LmZyYW1lID0gNDtcbiAgICB9XG5cbiAgICB0aGlzLnNwcml0ZUJsYXN0LnBvc2l0aW9uLnggPSB0aGlzLnNwcml0ZVRvb3QucG9zaXRpb24ueCAtIDM4O1xuICAgIHRoaXMuc3ByaXRlQmxhc3QucG9zaXRpb24ueSA9IHRoaXMuc3ByaXRlVG9vdC5wb3NpdGlvbi55ICsgODA7XG59O1xuXG50b290LmNoYXJhY3Rlci5QbGF5ZXIucHJvdG90eXBlLmdldENvbGxpZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNwcml0ZVRvb3Q7XG59O1xuIiwiXG50b290LmVudmlyb25tZW50LkJhY2tncm91bmQgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuQmFja2dyb3VuZC5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1zcGFjZScsICdpbWFnZXMvYmctc3BhY2UuanBnJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2JnLXN0YXJzLXNtYWxsJywgJ2ltYWdlcy9iZy1zdGFycy1zbWFsbC5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctc3RhcnMtZGVuc2UnLCAnaW1hZ2VzL2JnLXN0YXJzLXNtYWxsLWRlbnNlLnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiZy1zdGFycy1sYXJnZScsICdpbWFnZXMvYmctc3RhcnMtbGFyZ2UucG5nJyk7XG5cbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctaG9yaXpvbicsICdpbWFnZXMvYmctaG9yaXpvbi1ncmFkaWVudC5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnYmctbW91bnRhaW5zLTAxJywgJ2ltYWdlcy9iZy1tb3VudGFpbnMtMDEucG5nJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2JnLW1vdW50YWlucy0wMicsICdpbWFnZXMvYmctbW91bnRhaW5zLTAyLnBuZycpO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5CYWNrZ3JvdW5kLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aDtcbiAgICB2YXIgaCA9IHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQ7XG4gICAgdGhpcy5zcGFjZUJnID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1zcGFjZScpO1xuICAgIHRoaXMuc3RhcnNMZyA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB3LCBoLCAnYmctc3RhcnMtbGFyZ2UnKTtcbiAgICB0aGlzLnNwYWNlRHMgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLXN0YXJzLWRlbnNlJyk7XG4gICAgdGhpcy5zdGFyc1NtID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1zdGFycy1zbWFsbCcpO1xuXG4gICAgdGhpcy5ob3Jpem9uID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIDAsIHcsIGgsICdiZy1ob3Jpem9uJyk7XG5cbiAgICB0aGlzLm1vdW50YWluczEgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgdywgaCwgJ2JnLW1vdW50YWlucy0wMScpO1xuICAgIHRoaXMubW91bnRhaW5zMiA9IHRoaXMuZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCB3LCBoLCAnYmctbW91bnRhaW5zLTAyJyk7XG59O1xuXG50b290LmVudmlyb25tZW50LkJhY2tncm91bmQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3BhY2VCZy50aWxlUG9zaXRpb24ueCAtPSAwLjA3NTtcbiAgICB0aGlzLnN0YXJzTGcudGlsZVBvc2l0aW9uLnggLT0gMC4xMDA7XG4gICAgdGhpcy5zcGFjZURzLnRpbGVQb3NpdGlvbi54IC09IDAuMTI1O1xuICAgIHRoaXMuc3RhcnNTbS50aWxlUG9zaXRpb24ueCAtPSAwLjE1MDtcblxuICAgIHRoaXMubW91bnRhaW5zMS50aWxlUG9zaXRpb24ueCAtPSAwLjIwO1xuICAgIHRoaXMubW91bnRhaW5zMi50aWxlUG9zaXRpb24ueCAtPSAwLjI1O1xufTtcbiIsIlxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuR3JvdW5kLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2dyb3VuZCcsICdpbWFnZXMvZ3JvdW5kLmpwZycpO1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcblxuICAgIHZhciB5UG9zID0gaCAtIDk3O1xuICAgIHRoaXMuZ3JvdW5kID0gdGhpcy5nYW1lLmFkZC50aWxlU3ByaXRlKDAsIHlQb3MsIHcsIGgsICdncm91bmQnKTtcblxuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5ncm91bmQpO1xuICAgIHRoaXMuZ3JvdW5kLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcblxuICAgIC8vIGJ1ZyBpbiBwaGFzZXIgMi4zLjBcbiAgICAvLyBzZWU6IGh0dHA6Ly93d3cuaHRtbDVnYW1lZGV2cy5jb20vdG9waWMvMTM4NTYtcHJvYmxlbS13aXRoLWNvbGxpZGUtbWV0aG9kLWZyb20tcGh5c2ljcy1hcmNhZGUtaW4tZGlmZmVyZW50LXZlcnNpb25zLW9mLXBoYXNlci8/cD03OTAzMlxuICAgIHRoaXMuZ3JvdW5kLnBoeXNpY3NUeXBlID0gUGhhc2VyLlNQUklURTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuR3JvdW5kLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdyb3VuZC50aWxlUG9zaXRpb24ueCAtPSAwLjg1O1xufTtcblxudG9vdC5lbnZpcm9ubWVudC5Hcm91bmQucHJvdG90eXBlLmdldENvbGxpZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdyb3VuZDtcbn07XG4iLCJ0b290LmVudmlyb25tZW50LlZpZ25ldHRlID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG59O1xuXG50b290LmVudmlyb25tZW50LlZpZ25ldHRlLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ3ZpZ25ldHRlJywgJ2ltYWdlcy92aWduZXR0ZS5wbmcnKTtcbn07XG5cbnRvb3QuZW52aXJvbm1lbnQuVmlnbmV0dGUucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gdGhpcy5nYW1lLndvcmxkLndpZHRoO1xuICAgIHZhciBoID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodDtcbiAgICB0aGlzLnYgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZSgwLCAwLCAndmlnbmV0dGUnKTtcbn07XG4iLCJ0b290Lm9ic3RhY2xlLkdlbmVyYXRvciA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgIHRoaXMuc2F1Y2VyID0gbmV3IHRvb3Qub2JzdGFjbGUuU2F1Y2VyKHRoaXMuZ2FtZSk7XG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUucHJlbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2F1Y2VyLnByZWxvYWQoKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuR2VuZXJhdG9yLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aDtcbiAgICB2YXIgaCA9IHRoaXMuZ2FtZS53b3JsZC5oZWlnaHQ7XG5cbiAgICAvL3RoaXMucm9jayA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHcsIGggLyAyLCAncm9jaycpO1xuICAgIHRoaXMuc2F1Y2VyLmNyZWF0ZSgpO1xuXG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zYXVjZXIudXBkYXRlKCk7XG59O1xuXG50b290Lm9ic3RhY2xlLkdlbmVyYXRvci5wcm90b3R5cGUuZ2V0Q29sbGlkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2F1Y2VyLmdldENvbGxpZGVycygpO1xufTtcbiIsIlxudG9vdC5vYnN0YWNsZS5TYXVjZXIgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICB0aGlzLnNwcml0ZVNhdWNlciA9IG51bGw7XG4gICAgdGhpcy5jb2xsaXNpb25Hcm91cCA9IG51bGw7XG5cbiAgICB0aGlzLnZlbG9jaXR5ID0gMzAwO1xufTtcblxudG9vdC5vYnN0YWNsZS5TYXVjZXIucHJvdG90eXBlLnByZWxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUubG9hZC5zcHJpdGVzaGVldCgnc2F1Y2VyJywgJ2ltYWdlcy9zYXVjZXItc3ByaXRlc2hlZXQucG5nJywgMjc2LCAxMDApO1xufTtcblxudG9vdC5vYnN0YWNsZS5TYXVjZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud29ybGQud2lkdGggLSAxMDA7XG4gICAgdmFyIG1pbnkgPSA3O1xuICAgIHZhciBtYXh5ID0gdGhpcy5nYW1lLndvcmxkLmhlaWdodCAtIDIyNTtcblxuICAgIHZhciB5ID0gdGhpcy5nYW1lLnJuZC5pbnRlZ2VySW5SYW5nZShtaW55LCBtYXh5KTtcblxuICAgIGNvbnNvbGUubG9nKCdyZXNldHRpbmcgc2F1Y2VyIHRvICcgKyB4ICsgJywgJyArIHkpO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLnJlc2V0KHgsIHkpO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLmJvZHkudmVsb2NpdHkueCA9IHRoaXMudmVsb2NpdHkgKiAtMTtcblxuICAgIHRoaXMuczIucmVzZXQoeCwgeSk7XG4gICAgdGhpcy5zMi5ib2R5LnZlbG9jaXR5LnggPSB0aGlzLnZlbG9jaXR5ICogLTE7XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSB0aGlzLmdhbWUud29ybGQud2lkdGg7XG4gICAgdmFyIGggPSB0aGlzLmdhbWUud29ybGQuaGVpZ2h0O1xuXG4gICAgdGhpcy5jb2xsaXNpb25Hcm91cCA9IHRoaXMuZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKHRoaXMuY29sbGlzaW9uR3JvdXApO1xuICAgIC8vdGhpcy5jb2xsaXNpb25Hcm91cC5ib2R5LmFsbG93R3Jhdml0eSA9IGZhbHNlO1xuICAgIC8vdGhpcy5jb2xsaXNpb25Hcm91cC5ib2R5LmltbW92YWJsZSA9IHRydWU7XG4gICAgLy9cbiAgICB0aGlzLmNvbGxpc2lvbkdyb3VwLmNoZWNrV29ybGRCb3VuZHMgPSB0cnVlO1xuXG4gICAgLy90aGlzLnNwcml0ZVNhdWNlciA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHcsIDEyOCwgJ3NhdWNlcicpO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyID0gdGhpcy5jb2xsaXNpb25Hcm91cC5jcmVhdGUodywgMTI4LCAnc2F1Y2VyJyk7XG4gICAgLy90aGlzLnNwcml0ZVNhdWNlci5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcy5zcHJpdGVTYXVjZXIpO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLmJvZHkuYWxsb3dHcmF2aXR5ID0gZmFsc2U7XG4gICAgdGhpcy5zcHJpdGVTYXVjZXIuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIHRoaXMuc3ByaXRlU2F1Y2VyLmJvZHkuc2V0U2l6ZSg2NCwgMzIsIDk3LCA2KTtcblxuICAgIC8vdGhpcy5zMiA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHcsIDEyOCwgJycpO1xuICAgIHRoaXMuczIgPSB0aGlzLmNvbGxpc2lvbkdyb3VwLmNyZWF0ZSh3LCAxMjgsICcnKTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKHRoaXMuczIpO1xuICAgIHRoaXMuczIuYm9keS5hbGxvd0dyYXZpdHkgPSBmYWxzZTtcbiAgICB0aGlzLnMyLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcbiAgICB0aGlzLnMyLmJvZHkuc2V0U2l6ZSgyNjcsIDYyLCAwLCAzMik7XG5cbiAgICB0aGlzLnJlc2V0KCk7XG59O1xuXG50b290Lm9ic3RhY2xlLlNhdWNlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLnNwcml0ZVNhdWNlci5pbldvcmxkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzYXVjZXIgaXMgb2ZmIHdvcmxkIScpO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICAgIHRoaXMuZ2FtZS5kZWJ1Zy5ib2R5KHRoaXMuc3ByaXRlU2F1Y2VyKTtcbiAgICB0aGlzLmdhbWUuZGVidWcuYm9keSh0aGlzLnMyKTtcbn07XG5cbnRvb3Qub2JzdGFjbGUuU2F1Y2VyLnByb3RvdHlwZS5nZXRDb2xsaWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25Hcm91cDtcbn07XG4iLCJ0b290LnVpLkRpc3RhbmNlID0gZnVuY3Rpb24oZ2FtZSkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG59O1xuXG50b290LnVpLkRpc3RhbmNlLnByb3RvdHlwZS5wcmVsb2FkID0gZnVuY3Rpb24oKSB7XG59O1xuXG50b290LnVpLkRpc3RhbmNlLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IHRoaXMuZ2FtZS53b3JsZC53aWR0aDtcbiAgICB0aGlzLmRpc3BsYXkgPSB0aGlzLmdhbWUuYWRkLnRleHQoMTYsIDE2LCAnZGlzdGFuY2U6IDAnLCB7XG4gICAgICAgIGZvbnRTaXplOiAnMzJweCcsIGZpbGw6ICcjZmZmJ1xuICAgIH0pO1xufTtcblxudG9vdC51aS5EaXN0YW5jZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5kaXNwbGF5LnRleHQgPSAnZGlzdGFuY2U6ICcgKyBNYXRoLnJvdW5kKHRvb3QuY3VycmVudERpc3RhbmNlIC8gMTApO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==